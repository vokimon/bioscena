import os

options = Options('options.cache', ARGUMENTS)
options.Add(BoolOption('verbose', 'Display the full command line instead a short command description', 'no') )
options.Add(BoolOption('qtunit', 'Use the qt based test runner', 'no') )

env = Environment(ENV=os.environ, tools=['default'], options=options)
options.Save('../options.cache', env)
Help(options.GenerateHelpText(env))
env.SConsignFile() # Single signature file
env.Tool('qt4', toolpath=['..'])

env['CXXFILESUFFIX'] = '.cxx'
env['QT4_UICDECLSUFFIX'] = '.hxx'
env['QT4_MOCHPREFIX'] = os.path.join('moc_')
env['QT4_UICDECLPREFIX'] = os.path.join('uic_')
env['QT4_QRCCXXPREFIX'] = os.path.join('qrc_')
if not env['verbose']:
    env['CXXCOMSTR'] = '== Compiling $SOURCE'
    env['LINKCOMSTR'] = '== Linking $TARGET'
    env['SHLINKCOMSTR'] = '== Linking library $TARGET'
    env['QT4_RCCCOMSTR'] = '== Embeding resources $SOURCE'
    env['QT4_UICCOMSTR'] = '== Compiling interface $SOURCE'
    env['QT4_LRELEASECOMSTR'] = '== Compiling translation $TARGET'
    env['QT4_MOCFROMHCOMSTR'] = '== Generating metaobjects for $SOURCE'
    env['QT4_MOCFROMCXXCOMSTR'] = '== Generating metaobjects for $SOURCE'

env.EnableQt4Modules([
    'QtCore',
    'QtGui',
    'QtOpenGL',
], debug=True)

env.ParseConfig('cppunit-config --cflags --libs')
env.Append(CCFLAGS = ["-g"])
if env['qtunit'] :
	env.ParseConfig('pkg-config qt-mt --cflags --libs')
	env.Append(LIBS = ['qttestrunner'])
	env.Append(CCFLAGS = ["-DGUI_ENABLED"])

env.Append(BUILDERS = {'Test' : Builder(action = "./$SOURCE && touch $TARGET")})

Import('sources', 'testSources', 'includePath')
env.Append(CPPPATH = includePath)


env.Program('#BioscenaTests', testSources),
bioscena = env.Program('#Bioscena', sources),
env.Default( [
	env.Test('#BioscenaTests.passed', '#BioscenaTests' ),
])



